- name: Create temporary script for superuser creation
  copy:
    content: |
      from django.contrib.auth import get_user_model
      User = get_user_model()
      if not User.objects.filter(username="{{ django_admin_username }}").exists():
          User.objects.create_superuser("{{ django_admin_username }}", "{{ django_admin_email }}", "{{ django_admin_password }}")
          print("Creating superuser...")
      else:
          print("Superuser already exists, skipping.")
    dest: /tmp/create_superuser.py
    mode: '0644'

- name: Copy script to container
  command: docker cp /tmp/create_superuser.py binology-saas-web-app-1:/app/create_superuser.py

- name: Run script inside container
  command: docker exec binology-saas-web-app-1 python /app/create_superuser.py
  register: superuser_result
  changed_when: "'Creating superuser' in superuser_result.stdout"
  failed_when: "superuser_result.rc != 0 and 'Superuser already exists' not in superuser_result.stdout"

- name: Clean up temporary script
  file:
    path: /tmp/create_superuser.py
    state: absent




  # no_log: true
